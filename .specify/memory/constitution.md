<!--
同步影响报告
- 版本: 0.0.0 → 1.0.0
- 修改的原则: 新增 P1 代码质量守则, P2 目录结构与工件定位, P3 临时文件纪律, P4 文档与可维护性
- 添加的部分: 附加约束与结构约定, 开发工作流程与质量门禁, 治理
- 删除的部分: 无
- 模板同步:
  - ✅ .specify/templates/spec-template.md (无需更新)
  - ✅ .specify/templates/plan-template.md (无需更新)
  - ✅ .specify/templates/tasks-template.md (无需更新)
- 待处理事项:
  - ✅ 项目名称已设为 lumoscribe2033
-->

# lumoscribe2033 项目章程

## 核心原则

### P1 代码质量守则
- 所有功能需保持模块化边界, 避免巨石式文件或隐式耦合。
- 单个源文件的行数不得超过 4000 行, 超出时必须拆分为职责清晰的模块。
- 新增能力必须同步交付自动化单元测试, 并通过正式代码评审后方可合入主干。
- **架构质量原则（基于 2025-11-17 重构经验）**:
  - **DRY 原则**: 禁止重复代码。发现重复代码模式时，必须提取为可复用的组件、基类或工具函数。
  - **SOLID 原则**: 
    - **单一职责**: 每个类/模块只负责一个明确的功能领域。违反时需拆分为多个职责单一的组件。
    - **开闭原则**: 通过策略模式、适配器模式、工厂模式等设计模式实现扩展，而非修改现有代码。
    - **依赖倒置**: 客户端代码依赖抽象接口（ABC、Protocol），而非具体实现。
  - **设计模式优先**: 在需要扩展性时，优先使用策略模式、适配器模式、工厂模式等，而非硬编码的条件分支。
  - **接口统一**: 同一功能的不同实现必须通过统一接口暴露，使用适配器模式整合。

### P2 目录结构与工件定位
- 必须遵循当前项目结构中已定义的目录规范, 不允许随意新增顶层目录或模糊命名。
- 任何自动或手动生成的代码/文档都要写入预期路径(例如 `specs/`, `docs/`, `src/` 下的既定子目录), 禁止散落在临时目录。
- 生成脚本需在输出完成后验证文件是否落在正确位置, 否则视为构建失败。

### P3 临时文件纪律
- 临时脚本、草稿或调试工件只能存在于隔离的工作区, 使用完毕立即删除, 不得提交到仓库。
- 运行 speckit 或其他脚本时若必须生成缓存, 需在命令流程中显式清理, 保证仓库保持干净状态。
- CI/CD 管道需检查并阻止包含临时文件(如 `.tmp`, `debug.log`, 未命名文档)的提交。

### P4 文档与可维护性
- 所有自动生成的文档或代码文件必须在文件头部标注生成命令与时间戳, 以便追溯来源。
- 函数、组件、脚本若包含非显而易见的约束或副作用, 必须通过行内注释或同目录 README 进行说明。
- 重大设计决策需在 `docs/` 或对应 `specs/` 下记录理由, 保证后续维护者能复现上下文。

## 附加约束与结构约定
- 业务与基础设施代码需要分层摆放, 例如 `src/domain/`, `src/application/`, `src/interfaces/`, 以便模块化拆分文件。
- 公共组件或工具库必须放入共享目录(如 `src/shared/`), 并附带最小 README 说明复用方式。
- 目录调整或新增子系统前, 需更新相关文档(如 plan.md 的“项目结构”段落)并获得评审确认。
- 开发与调试的基础环境为 Windows 11, 默认字符集 UTF-8; 所有脚本与工具必须在该环境下通过验证。
- 项目依赖通过名为 `lumoscribe2033` 的 Conda 环境统一管理; 文档中的命令示例应展示激活步骤(`conda activate lumoscribe2033`)。
- 团队沟通(含规范、计划、任务、代码注释、PR 描述)一律使用中文, 确保术语一致与可审阅性。

## 开发工作流程与质量门禁
- 每个功能分支必须引用对应的 `specs/[feature]/` 文档, 并在 PR 描述中说明受影响的章程原则。
- 所有 PR 需要至少一名 reviewer 确认通过, 并在检查清单中显式标记"单元测试已更新""目录规范已验证""架构质量检查通过"。
- CI 流水线需包含: 静态代码检查、单元测试套件、临时文件扫描、文件长度守卫(检测 >4000 行)、代码重复度检查。
- 若 CI 发现文件长度超限、代码重复度 >5%、生成目录异常或违反 SOLID 原则, PR 必须回退并整改后再提交。
- 任何代码或行为变更都必须同步更新相关文档(如 spec.md、plan.md、tasks.md、README、架构图); PR 需明确列出受影响文档并完成更新或说明原因。
- 若更新影响 speckit 产物, 必须按照顺序重新运行对应命令(`/speckit.specify` → `/speckit.plan` → `/speckit.tasks`)并复查 `/speckit.analyze`, 确保文档与实现保持一致。
- **重构检查清单**（新增功能或修改现有功能时）:
  - [ ] 是否存在重复代码？如有，是否已提取为可复用组件？
  - [ ] 类/模块是否违反单一职责原则？如有，是否已拆分？
  - [ ] 是否需要扩展性？如有，是否使用了设计模式而非硬编码？
  - [ ] 接口是否统一？不同实现是否通过适配器模式整合？
  - [ ] 错误处理是否使用了统一的上下文管理器或装饰器？

## 治理
- 本章程优先于仓库内其他流程指引; 若存在冲突, 首先以章程为准, 并在需要时修订下游文档。
- 任何原则的修改或新增需在提案中说明动机、影响与迁移计划, 并由核心维护者批准后方可生效。
- 版本递增遵循语义化: 删除/重写原则视为 MAJOR, 新增或大幅扩展视为 MINOR, 文字澄清视为 PATCH。
- 每半年至少回顾一次章程执行情况, 若在 review 中发现违反临时文件或文件长度守则, 必须制定纠偏任务。

**版本**: 1.1.0 | **批准日期**: 2025-11-14 | **最后修正**: 2025-11-17

## 版本历史
- **1.1.0** (2025-11-17): 新增架构质量原则（DRY、SOLID、设计模式），添加重构检查清单
- **1.0.0** (2025-11-14): 初始版本，定义 P1-P4 核心原则
